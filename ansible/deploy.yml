---
- hosts: all
  vars_files:
    - vars.yml
  gather_facts: false
  become: yes

  tasks:
    - name: Install pip
      apt:
         name: python3-pip
         update_cache: yes
         state: present


    - name: copy nginx config
      template: src=files/nginx.j2 dest=/etc/nginx/sites-enabled/{{ project_name }}


    - name: create symlink
      file:
        src: /etc/nginx/sites-available/{{ project_name }}
        dest: /etc/nginx/sites-enabled/{{ project_name }}
        state: link
      become: yes
      notify:
         - restart nginx

    - name: make sure nginx server is running
      service: name=nginx state=started enabled=yes



  handlers:
    - name: restart nginx
      service: name=nginx state=restarted
